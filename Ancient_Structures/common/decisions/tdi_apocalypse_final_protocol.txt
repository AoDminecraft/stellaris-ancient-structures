# The Final Protocol - Victory or Oblivion

# COUNTRY-SCOPED DECISIONS
decision_tdi_activate_final_protocol = {
	owned_planets_only = yes
	
	sound = event_mystic_reveal
	icon = decision_glitchy_matrix
	enactment_time = 0
	
	resources = {
		category = decisions
		cost = {
			influence = 1000
			unity = 100000
		}
	}
	
	potential = {
		owner = {
			has_country_flag = tdi_ancient_apocalypse_engine_operational
			NOT = { has_country_flag = tdi_final_protocol_activated }
			# Move the time check here
			has_country_flag = tdi_apocalypse_engine_25_years
		}
	}
	
	allow = {
		owner = {
			# Victory requirement - must have significant power/territory
			OR = {
				num_owned_planets > 50
				fleet_power > 2000000
				NOT = {
					any_country = {
						is_country_type = fallen_empire
						is_at_war_with = prev
					}
				}
			}
		}
	}
	
	effect = {
		custom_tooltip = decision_tdi_final_protocol_effect
		hidden_effect = {
			owner = {
				set_country_flag = tdi_final_protocol_activated
				country_event = { id = tdi_final_protocol.1 }
			}
		}
	}
	
	ai_weight = {
		weight = 0
	}
}

decision_tdi_apotheosis_transcend = {
	owned_planets_only = yes
	
	sound = event_mystic_reveal
	icon = decision_glitchy_matrix
	enactment_time = 0
	
	resources = {
		category = decisions
		cost = {
			influence = 2000
			unity = 500000
			energy = 100000
			sr_dark_matter = 10000
			sr_living_metal = 10000
			nanites = 10000
		}
	}
	
	potential = {
		owner = {
			has_country_flag = tdi_final_protocol_activated
			has_country_flag = tdi_apotheosis_path_unlocked
			NOT = { has_country_flag = tdi_apotheosis_complete }
		}
	}
	
	allow = {
		owner = {
			has_country_flag = tdi_final_protocol_stage_5
		}
	}
	
	effect = {
		custom_tooltip = decision_tdi_apotheosis_effect
		hidden_effect = {
			owner = {
				set_country_flag = tdi_apotheosis_complete
				country_event = { id = tdi_final_protocol.100 }
			}
		}
	}
	
	ai_weight = {
		weight = 1000
	}
}

decision_tdi_omnicide = {
	owned_planets_only = yes
	
	sound = event_mystic_reveal
	icon = decision_glitchy_matrix
	enactment_time = 0
	
	resources = {
		category = decisions
		cost = {
			influence = 2000
			unity = 500000
		}
	}
	
	potential = {
		owner = {
			has_country_flag = tdi_final_protocol_activated
			has_country_flag = tdi_omnicide_path_unlocked
			NOT = { has_country_flag = tdi_omnicide_complete }
		}
	}
	
	allow = {
		owner = {
			OR = {
				num_owned_planets > 100
				NOT = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = prev }
					}
				}
			}
		}
	}
	
	effect = {
		custom_tooltip = decision_tdi_omnicide_effect
		hidden_effect = {
			owner = {
				set_country_flag = tdi_omnicide_complete
				country_event = { id = tdi_final_protocol.200 }
			}
		}
	}
	
	ai_weight = {
		weight = 500
	}
}